---
description: Defines metadata-based component generation rules for React + TypeScript projects. Focuses on development processes based on Event Storming stickers beyond basic project setup.
globs: Frontend-PRD.txt
alwaysApply: false
---

# Metadata-Based Frontend Component Generation Rules

This rule defines the process for generating components based on Event Storming metadata when the basic project structure is already created.

**Prerequisites**: 
- Basic frontend project must be generated through `frontend-setup-prd.md`
- Basic structure must be set up through `frontend-setup-prd.md`

## Metadata-Based Component Generation Sequence
```
Analyze metadata → Create BoundedContext folders → Generate Aggregate-based components → Discover API endpoints → Generate Command components (conditional) → Generate ReadModel components (conditional) → Connect generated Odoo-related components → Configure routing → Environment variables and Gateway configuration → check `@frontend-troubleshooting-rules`
```

## Step-by-Step Component Generation Process

### Step 1: Metadata Analysis and Validation
- **Aggregate Components**: Generate Page, Form, Table, Card + service, types, store, hook
- **Command Components**: Generate Button, Modal only when `isRestRepository: false`
- **View Components**: Generate Dashboard when `dataProjection: 'cqrs'`, Search when `query-for-aggregate`

### Step 2: BoundedContext Folder Structure Generation
Create folders for each BoundedContext: `src/components/[BC]`, `src/pages/[BC]`, `src/hooks/[BC]`, `src/services/[BC]`, `src/store/[BC]`, `src/types/[BC]`

### Step 3: Aggregate-Based Component Generation
Generate CRUD component set for each aggregate:
- **Components**: `[Aggregate]Page.tsx`, `[Aggregate]Form.tsx`, `[Aggregate]Table.tsx`, `[Aggregate]Card.tsx`
- **Services**: `[aggregate].service.ts`, `[aggregate].types.ts`, `[aggregate].store.ts`, `use[Aggregate].ts`

### Step 4: API Endpoint Discovery
When discovering Command-related components and API endpoints to be generated in Step 5, consider the following priorities:
- Priority 1: Analyze API endpoints according to Commands to be generated through analysis of infra/Controller.java files under services created with BoundedContext.name
- Priority 2: Analyze API endpoints based on openapi.yaml under each service if Controller.java doesn't exist

### Step 5: Command-Based Component Generation (Conditional)
Generate only commands where `isRestRepository: false`:
- **Components**: `[Command]Button.tsx`, `[Command]Modal.tsx`  
- **Services**: `[command].service.ts`, `[command].types.ts`, `use[Command].ts`

### Step 6: ReadModel/View-Based Component Generation (Conditional)
- **Search**: `dataProjection: 'query-for-aggregate'` + `queryParameters` exists → `[View]Search.tsx`
- **Dashboard**: `dataProjection: 'cqrs'` + `fieldDescriptors` exists → `[View]Dashboard.tsx`, `[View]Page.tsx`

### Step 7: Connect Odoo-Related Generated Files and Components
- Review components generated through `@erp-component-prd.txt`
- Enable Aggregate component UI to call and import these components

### Step 8: Routing Configuration (Metadata-Based)
- **BC Routes**: `/${boundedContext.name}`
- **Aggregate Routes**: `/${boundedContext}/${aggregate.namePlural}`  
- **View Routes**: `/${view.namePlural}` (CQRS only)

### Step 9: Environment Variables and Gateway Configuration
- **Environment Settings**: Set `VITE_GATEWAY_URL=http://localhost:8088` in `.env`, `.env.development`, `.env.production`
- Gateway Route Configuration: Specify Frontend route (localhost:3000) in gateway's `application.yaml` routes
- **API Path Validation**: Aggregate → `/${aggregate.namePlural}`, Command → `/${aggregate.namePlural}/{id}/{command.name}`

## Generation Guidelines

### Key Requirements
- All component generation must be strictly based on metadata
- Generate components only when required metadata fields exist
- Follow dependency order: Types → Services → Hooks → Components

### Error Handling
- Skip generation for non-existent metadata
- Confirm whether to overwrite existing components

### Validation Checklist
check `@frontend-troubleshooting-rules`
1. **Gateway Connection**: Verify `localhost:8088` access
2. **Environment Variables**: Verify `VITE_GATEWAY_URL` setting in `.env`
3. **Route Access**: Verify all generated pages load properly
4. **API Integration**: Verify CRUD and command operations work

### Troubleshooting
- **CORS Errors**: Check Gateway CORS configuration
- **404 Errors**: Verify backend controller paths match frontend service paths
- **Connection Refused**: Verify Gateway is running on port 8088
- **Favicon Errors**: Implement preventive measures for frequently occurring favicon errors
